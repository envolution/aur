[openfoam]
source = 'cmd'
cmd = """
get_latest_openfoam_version() {
  export GIT_TERMINAL_PROMPT=0
  
  # Find the latest OpenFOAM repository version (highest number)
  for i in {13..40}; do
    gh api "repos/OpenFOAM/OpenFOAM-$i" &>/dev/null &&
    LATEST=$i || break
  done
  
  if [ -z "$LATEST" ]; then
    exit 1
  fi
  
  # Get all tags from the latest repository and filter for date-formatted tags
  # Date tags are 8 digits (YYYYMMDD format)
  LATEST_TAG_INFO=$(gh api "repos/OpenFOAM/OpenFOAM-${LATEST}/git/refs/tags" --paginate \
    | jq -r '.[] | select(.ref | test("refs/tags/[0-9]{8}$")) | "\\(.object.sha) \\(.ref)"' \
    | sort -k2 | tail -n1)
  
  if [ -n "$LATEST_TAG_INFO" ]; then
    COMMIT_HASH=$(echo "$LATEST_TAG_INFO" | awk '{print $1}')
    TAG_DATE=$(echo "$LATEST_TAG_INFO" | awk '{print $2}' | sed 's|refs/tags/||')
    SHORT_HASH=$(echo "$COMMIT_HASH" | cut -c1-7)
    LATEST_VERSION="${LATEST}.${TAG_DATE}+${SHORT_HASH}"
  else
    exit 1
  fi
  
  echo "$LATEST_VERSION" | awk '{ 
    print $0
    if ($0 !~ /^[0-9]{2}[.][0-9]{8}[+][a-f0-9]{7}$/) exit 1 
  }'
}
get_latest_openfoam_version
"""
